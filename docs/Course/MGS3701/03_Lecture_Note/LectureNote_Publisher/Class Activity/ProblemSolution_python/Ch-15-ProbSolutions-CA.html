<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 15: Cluster Analysis – Chad’s Course Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../../">
<script src="../../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../../index.html">
    <span class="navbar-title">Chad’s Course Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ge2021-reserach-technology" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GE2021: Reserach Technology</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ge2021-reserach-technology">    
        <li>
    <a class="dropdown-item" href="../../../../../../Course/GE2021/03_Lecture_Note/LectureNote_Chad/PPT/chapter0/chapter0.html">
 <span class="dropdown-text">Course Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/GE2021/03_Lecture_Note/LectureNote_Chad/PPT/chapter1/chapter1.html">
 <span class="dropdown-text">Chapter1 Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/GE2021/03_Lecture_Note/LectureNote_Chad/PPT/chapter2/chapter2.html">
 <span class="dropdown-text">Chapter2 Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/GE2021/03_Lecture_Note/LectureNote_Chad/PPT/chapter3/chapter3.html">
 <span class="dropdown-text">Chapter3 Slide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mgs3001-python-for-business" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MGS3001: Python for Business</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mgs3001-python-for-business">    
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3001/03_Lecture_Note/LectureNote_Chad/PPT/chapter0/chapter0.html">
 <span class="dropdown-text">Course Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3001/03_Lecture_Note/LectureNote_Chad/PPT/chapter1/chapter1.html">
 <span class="dropdown-text">Chapter1 Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3001/03_Lecture_Note/LectureNote_Chad/PPT/chapter2/chapter2.html">
 <span class="dropdown-text">Chapter2 Slide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mgs3701-data-mining" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">MGS3701: Data Mining</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mgs3701-data-mining">    
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/PPT/chapter0/chapter0.html">
 <span class="dropdown-text">Course Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/PPT/chapter1/chapter1.html">
 <span class="dropdown-text">Chapter1 Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/Lecture_Note/chapter1/chapter1_note.html">
 <span class="dropdown-text">Chapter1 Lecture Note</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/PPT/chapter2/chapter2.html">
 <span class="dropdown-text">Chapter2 Slide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/Lecture_Note/chapter2/chapter2_note.html">
 <span class="dropdown-text">Chapter2 Lecture Note</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../Course/MGS3701/03_Lecture_Note/LectureNote_Chad/Class_Activity/ProblemSolution_python/Ch-02-ProbSolutions-Overview.html">
 <span class="dropdown-text">Chapter2 Problem and Solution [Python]</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#problem-15.1-university-rankings" id="toc-problem-15.1-university-rankings" class="nav-link active" data-scroll-target="#problem-15.1-university-rankings">Problem 15.1: University Rankings</a>
  <ul class="collapse">
  <li><a href="#solution-15.1.a" id="toc-solution-15.1.a" class="nav-link" data-scroll-target="#solution-15.1.a">Solution 15.1.a</a></li>
  <li><a href="#solution-15.1.b" id="toc-solution-15.1.b" class="nav-link" data-scroll-target="#solution-15.1.b">Solution 15.1.b</a></li>
  <li><a href="#solution-15.1.c" id="toc-solution-15.1.c" class="nav-link" data-scroll-target="#solution-15.1.c">Solution 15.1.c</a></li>
  <li><a href="#solution-15.1.d" id="toc-solution-15.1.d" class="nav-link" data-scroll-target="#solution-15.1.d">Solution 15.1.d</a></li>
  <li><a href="#solution-15.1.e" id="toc-solution-15.1.e" class="nav-link" data-scroll-target="#solution-15.1.e">Solution 15.1.e</a></li>
  <li><a href="#solution-15.1.f" id="toc-solution-15.1.f" class="nav-link" data-scroll-target="#solution-15.1.f">Solution 15.1.f</a></li>
  </ul></li>
  <li><a href="#problem-15.2-pharmaceutical-industry" id="toc-problem-15.2-pharmaceutical-industry" class="nav-link" data-scroll-target="#problem-15.2-pharmaceutical-industry">Problem 15.2: Pharmaceutical Industry</a>
  <ul class="collapse">
  <li><a href="#solution-15.2.a" id="toc-solution-15.2.a" class="nav-link" data-scroll-target="#solution-15.2.a">Solution 15.2.a</a></li>
  <li><a href="#solution-15.2.b" id="toc-solution-15.2.b" class="nav-link" data-scroll-target="#solution-15.2.b">Solution 15.2.b</a></li>
  <li><a href="#solution-15.2.c" id="toc-solution-15.2.c" class="nav-link" data-scroll-target="#solution-15.2.c">Solution 15.2.c</a></li>
  <li><a href="#solution-15.2.d" id="toc-solution-15.2.d" class="nav-link" data-scroll-target="#solution-15.2.d">Solution 15.2.d</a></li>
  </ul></li>
  <li><a href="#problem-15.3-customer-rating-of-breakfast-cereals" id="toc-problem-15.3-customer-rating-of-breakfast-cereals" class="nav-link" data-scroll-target="#problem-15.3-customer-rating-of-breakfast-cereals">Problem 15.3: Customer Rating of Breakfast Cereals</a>
  <ul class="collapse">
  <li><a href="#solution-15.3.a" id="toc-solution-15.3.a" class="nav-link" data-scroll-target="#solution-15.3.a">Solution 15.3.a</a></li>
  <li><a href="#solution-15.3.b" id="toc-solution-15.3.b" class="nav-link" data-scroll-target="#solution-15.3.b">Solution 15.3.b</a></li>
  <li><a href="#solution-15.3.c" id="toc-solution-15.3.c" class="nav-link" data-scroll-target="#solution-15.3.c">Solution 15.3.c</a></li>
  <li><a href="#solution-15.3.d" id="toc-solution-15.3.d" class="nav-link" data-scroll-target="#solution-15.3.d">Solution 15.3.d</a></li>
  </ul></li>
  <li><a href="#problem-15.4-marketing-to-frequent-fliers" id="toc-problem-15.4-marketing-to-frequent-fliers" class="nav-link" data-scroll-target="#problem-15.4-marketing-to-frequent-fliers">Problem 15.4: Marketing to Frequent Fliers</a>
  <ul class="collapse">
  <li><a href="#solution-15.4.a" id="toc-solution-15.4.a" class="nav-link" data-scroll-target="#solution-15.4.a">Solution 15.4.a</a></li>
  <li><a href="#solution-15.4.b" id="toc-solution-15.4.b" class="nav-link" data-scroll-target="#solution-15.4.b">Solution 15.4.b</a></li>
  <li><a href="#solution-15.4.c" id="toc-solution-15.4.c" class="nav-link" data-scroll-target="#solution-15.4.c">Solution 15.4.c</a></li>
  <li><a href="#solution-15.4.d" id="toc-solution-15.4.d" class="nav-link" data-scroll-target="#solution-15.4.d">Solution 15.4.d</a></li>
  <li><a href="#solution-15.4.e" id="toc-solution-15.4.e" class="nav-link" data-scroll-target="#solution-15.4.e">Solution 15.4.e</a></li>
  <li><a href="#solution-15.4.f" id="toc-solution-15.4.f" class="nav-link" data-scroll-target="#solution-15.4.f">Solution 15.4.f</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 15: Cluster Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<ol start="3" type="a">
<li>2019-2020 Galit Shmueli, Peter C. Bruce, Peter Gedeck</li>
</ol>
<p><em>Data Mining for Business Analytics: Concepts, Techniques, and Applications in Python</em> (First Edition) Galit Shmueli, Peter C. Bruce, Peter Gedeck, and Nitin R. Patel. 2019.</p>
<p>Date: 2020-03-08</p>
<p>Python Version: 3.8.2 Jupyter Notebook Version: 5.6.1</p>
<p>Packages: - matplotlib: 3.2.0 - numpy: 1.18.1 - pandas: 1.0.1 - scipy: 1.4.1 - scikit-learn: 0.22.2</p>
<p>The assistance from Mr.&nbsp;Kuber Deokar and Ms.&nbsp;Anuja Kulkarni in preparing these solutions is gratefully acknowledged.</p>
</blockquote>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required packages for this chapter</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> parallel_coordinates</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> linkage, dendrogram, fcluster</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Working directory:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We assume that data are kept in the same directory as the notebook. If you keep your </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># data in a different folder, replace the argument of the `Path`</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>DATA <span class="op">=</span> Path(<span class="st">'.'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and then load data using </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.read_csv(DATA / ‘filename.csv’)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="problem-15.1-university-rankings" class="level1">
<h1>Problem 15.1: University Rankings</h1>
<p>The dataset on American College and University Rankings (available from www.dataminingbook.com) contains information on 1302 American colleges and universities offering an undergraduate program. For each university, there are 17 measurements, including continuous measurements (such as tuition and graduation rate) and categorical measurements (such as location by state and whether it is a private or public school).</p>
<p>Note that many records are missing some measurements. Our first goal is to estimate these missing values from “similar” records. This will be done by clustering the complete records and then finding the closest cluster for each of the partial records. The missing values will be imputed from the information in that cluster.</p>
<section id="solution-15.1.a" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.a">Solution 15.1.a</h2>
<p>Remove all records with missing measurements from the dataset.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>full_df <span class="op">=</span> pd.read_csv(DATA <span class="op">/</span> <span class="st">'Universities.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Before: '</span>, full_df.shape)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>universities_df <span class="op">=</span> full_df.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'After: '</span>, universities_df.shape)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>universities_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Before:  (1302, 20)
After:  (471, 20)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">College Name</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Public (1)/ Private (2)</th>
<th data-quarto-table-cell-role="th"># appli. rec'd</th>
<th data-quarto-table-cell-role="th"># appl. accepted</th>
<th data-quarto-table-cell-role="th"># new stud. enrolled</th>
<th data-quarto-table-cell-role="th">% new stud. from top 10%</th>
<th data-quarto-table-cell-role="th">% new stud. from top 25%</th>
<th data-quarto-table-cell-role="th"># FT undergrad</th>
<th data-quarto-table-cell-role="th"># PT undergrad</th>
<th data-quarto-table-cell-role="th">in-state tuition</th>
<th data-quarto-table-cell-role="th">out-of-state tuition</th>
<th data-quarto-table-cell-role="th">room</th>
<th data-quarto-table-cell-role="th">board</th>
<th data-quarto-table-cell-role="th">add. fees</th>
<th data-quarto-table-cell-role="th">estim. book costs</th>
<th data-quarto-table-cell-role="th">estim. personal $</th>
<th data-quarto-table-cell-role="th">% fac. w/PHD</th>
<th data-quarto-table-cell-role="th">stud./fac. ratio</th>
<th data-quarto-table-cell-role="th">Graduation rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alaska Pacific University</td>
<td>AK</td>
<td>2</td>
<td>193.0</td>
<td>146.0</td>
<td>55.0</td>
<td>16.0</td>
<td>44.0</td>
<td>249.0</td>
<td>869.0</td>
<td>7560.0</td>
<td>7560.0</td>
<td>1620.0</td>
<td>2500.0</td>
<td>130.0</td>
<td>800.0</td>
<td>1500.0</td>
<td>76.0</td>
<td>11.9</td>
<td>15.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>University of Alaska Southeast</td>
<td>AK</td>
<td>1</td>
<td>146.0</td>
<td>117.0</td>
<td>89.0</td>
<td>4.0</td>
<td>24.0</td>
<td>492.0</td>
<td>1849.0</td>
<td>1742.0</td>
<td>5226.0</td>
<td>2514.0</td>
<td>2250.0</td>
<td>34.0</td>
<td>500.0</td>
<td>1162.0</td>
<td>39.0</td>
<td>9.5</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Birmingham-Southern College</td>
<td>AL</td>
<td>2</td>
<td>805.0</td>
<td>588.0</td>
<td>287.0</td>
<td>67.0</td>
<td>88.0</td>
<td>1376.0</td>
<td>207.0</td>
<td>11660.0</td>
<td>11660.0</td>
<td>2050.0</td>
<td>2430.0</td>
<td>120.0</td>
<td>400.0</td>
<td>900.0</td>
<td>74.0</td>
<td>14.0</td>
<td>72.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Huntingdon College</td>
<td>AL</td>
<td>2</td>
<td>608.0</td>
<td>520.0</td>
<td>127.0</td>
<td>26.0</td>
<td>47.0</td>
<td>538.0</td>
<td>126.0</td>
<td>8080.0</td>
<td>8080.0</td>
<td>1380.0</td>
<td>2540.0</td>
<td>100.0</td>
<td>500.0</td>
<td>1100.0</td>
<td>63.0</td>
<td>11.4</td>
<td>44.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>Talladega College</td>
<td>AL</td>
<td>2</td>
<td>4414.0</td>
<td>1500.0</td>
<td>335.0</td>
<td>30.0</td>
<td>60.0</td>
<td>908.0</td>
<td>119.0</td>
<td>5666.0</td>
<td>5666.0</td>
<td>1424.0</td>
<td>1540.0</td>
<td>418.0</td>
<td>1000.0</td>
<td>1400.0</td>
<td>56.0</td>
<td>15.5</td>
<td>46.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="solution-15.1.b" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.b">Solution 15.1.b</h2>
<p>For all the continuous measurements, run hierarchical clustering using complete linkage and Euclidean distance. Make sure to normalize the measurements. From the dendrogram: How many clusters seem reasonable for describing these data?</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce to continuous measurements and normalize data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>reduced_df <span class="op">=</span> universities_df.drop(columns<span class="op">=</span>[<span class="st">'College Name'</span>, <span class="st">'State'</span>, <span class="st">'Public (1)/ Private (2)'</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>universities_norm <span class="op">=</span> (reduced_df <span class="op">-</span> reduced_df.mean()) <span class="op">/</span> reduced_df.std()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Hierarchical clustering using complete linkage and Euclidean distance </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> linkage(universities_norm, method<span class="op">=</span><span class="st">'complete'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>dendrogram(Z, no_labels<span class="op">=</span><span class="va">True</span>, color_threshold<span class="op">=</span><span class="dv">55</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try splitting into different number of clustesr</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>memb <span class="op">=</span> fcluster(Z, <span class="dv">2</span>, criterion<span class="op">=</span><span class="st">'maxclust'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>np.unique(memb, return_counts<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>(array([1, 2], dtype=int32), array([458,  13]))</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>np.unique(fcluster(Z, <span class="dv">4</span>, criterion<span class="op">=</span><span class="st">'maxclust'</span>), return_counts<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>(array([1, 2, 3, 4], dtype=int32), array([457,   1,  12,   1]))</code></pre>
</div>
</div>
<p>If we select #clusters = 2, we have on big cluster and one small cluster. Looking at the same dendrogram, we see that 4 clusters is also a possibility, on similar grounds. The following analysis is for 2 clusters, but a similar analysis could be conducted for different number of clusters.</p>
</section>
<section id="solution-15.1.c" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.c">Solution 15.1.c</h2>
<p>Compare the summary statistics for each cluster and describe each cluster in this context (e.g., “Universities with high tuition, low acceptance rate…”). (<em>Hint</em>: To obtain cluster statistics for hierarchical clustering, use the pandas method <em>groupby(clusterlabel)</em> together with methods such as <em>mean</em> or <em>median</em>.)</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> {}</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> reduced_df.groupby(memb):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    centroids[<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key)] <span class="op">=</span> item.mean()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(centroids).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster 1</th>
<th data-quarto-table-cell-role="th">Cluster 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th"># appli. rec'd</td>
<td>2747.43</td>
<td>17235.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th"># appl. accepted</td>
<td>1790.03</td>
<td>11678.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"># new stud. enrolled</td>
<td>683.45</td>
<td>4207.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">% new stud. from top 10%</td>
<td>27.81</td>
<td>35.15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">% new stud. from top 25%</td>
<td>55.27</td>
<td>69.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th"># FT undergrad</td>
<td>3078.83</td>
<td>20618.54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"># PT undergrad</td>
<td>684.05</td>
<td>4792.69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">in-state tuition</td>
<td>9480.30</td>
<td>6811.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">out-of-state tuition</td>
<td>10579.12</td>
<td>10435.54</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">room</td>
<td>2214.19</td>
<td>2464.85</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">board</td>
<td>2113.93</td>
<td>2404.31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">add. fees</td>
<td>369.67</td>
<td>708.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">estim. book costs</td>
<td>547.77</td>
<td>584.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">estim. personal $</td>
<td>1294.43</td>
<td>1928.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">% fac. w/PHD</td>
<td>72.86</td>
<td>85.38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">stud./fac. ratio</td>
<td>13.91</td>
<td>15.98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Graduation rate</td>
<td>65.59</td>
<td>64.69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Cluster 2 contains universities with high enrollment numbers, higher college entrance exam scores, and lower tuition fees. Cluster 1 contains universities with lower enrollment numbers and higher tuition fees. Other numbers are comparable.</p>
</section>
<section id="solution-15.1.d" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.d">Solution 15.1.d</h2>
<p>Use the categorical measurements that were not used in the analysis (State and Private/Public) to characterize the different clusters. Is there any relationship between the clusters and the categorical information?</p>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> universities_df.groupby(memb):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(item[<span class="st">'Public (1)/ Private (2)'</span>].value_counts().sort_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster 1
1    119
2    339
Name: Public (1)/ Private (2), dtype: int64
Cluster 2
1    9
2    4
Name: Public (1)/ Private (2), dtype: int64</code></pre>
</div>
</div>
<p>Cluster 2 is predominantly public, cluster 1 private.</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> universities_df.groupby(memb):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(item.State.value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster 1
PA    41
NY    37
OH    24
NC    23
MA    19
IA    18
TX    18
TN    15
MO    15
VA    15
IN    15
IL    14
CA    14
NJ    12
MI    12
MN    10
CT    10
WI     9
SC     9
FL     8
GA     7
NE     7
VT     7
KS     7
OK     6
NH     6
ME     6
KY     6
CO     6
ND     5
LA     5
MS     5
OR     5
AR     4
DC     4
AL     4
RI     4
SD     4
MD     3
NM     2
ID     2
MT     2
WA     2
WV     2
AK     2
UT     2
DE     2
WY     1
HI     1
AZ     1
Name: State, dtype: int64
Cluster 2
MA    3
TX    2
NY    1
CA    1
NJ    1
PA    1
IL    1
MI    1
AZ    1
MN    1
Name: State, dtype: int64</code></pre>
</div>
</div>
<p>There is no real geographic pattern.</p>
</section>
<section id="solution-15.1.e" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.e">Solution 15.1.e</h2>
<p>What other external information can explain the contents of some or all of these clusters?</p>
<p>State, not being a numeric variable, is not included in the clustering criteria. Note that southern states are under-represented in cluster 1 compared to cluster 2, and New England states are under-represented in cluster 2. Each group tends to have distinctive social and cultural norms. For example, sports receives relatively greater influence in the south than in New England. New England is known for its private college preparatory schools (particularly its elite ones) that feed students into selective (usually private and, hence, unsubsidized) universities. These factors could contribute to the higher cost and higher college entrance exam scores of cluster 1.</p>
<p>Recall that all variables must be present for a school to be included in the clustering process. Note that most of the Ivy League and several other key top schools are missing - this could be because they choose not to report some of the data used in the US News rankings. Since these schools are missing in the “cluster-building” phase, it is possible that our set of clusters is incomplete. So, our set of clusters may be incomplete.</p>
<p>There may be other factors as well that could inform our clustering process.</p>
</section>
<section id="solution-15.1.f" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.1.f">Solution 15.1.f</h2>
<p>Consider Tufts University, which is missing some information. Compute the Euclidean distance of this record from each of the clusters that you found above (using only the measurements that you have). Which cluster is it closest to? Impute the missing values for Tufts by taking the average of the cluster on those measurements.</p>
<div id="cell-21" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the cluster centroids</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> universities_norm.groupby(memb).mean()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>centroids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"># appli. rec'd</th>
<th data-quarto-table-cell-role="th"># appl. accepted</th>
<th data-quarto-table-cell-role="th"># new stud. enrolled</th>
<th data-quarto-table-cell-role="th">% new stud. from top 10%</th>
<th data-quarto-table-cell-role="th">% new stud. from top 25%</th>
<th data-quarto-table-cell-role="th"># FT undergrad</th>
<th data-quarto-table-cell-role="th"># PT undergrad</th>
<th data-quarto-table-cell-role="th">in-state tuition</th>
<th data-quarto-table-cell-role="th">out-of-state tuition</th>
<th data-quarto-table-cell-role="th">room</th>
<th data-quarto-table-cell-role="th">board</th>
<th data-quarto-table-cell-role="th">add. fees</th>
<th data-quarto-table-cell-role="th">estim. book costs</th>
<th data-quarto-table-cell-role="th">estim. personal $</th>
<th data-quarto-table-cell-role="th">% fac. w/PHD</th>
<th data-quarto-table-cell-role="th">stud./fac. ratio</th>
<th data-quarto-table-cell-role="th">Graduation rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.098174</td>
<td>-0.109007</td>
<td>-0.106214</td>
<td>-0.010969</td>
<td>-0.018749</td>
<td>-0.103681</td>
<td>-0.073362</td>
<td>0.013353</td>
<td>0.000919</td>
<td>-0.009701</td>
<td>-0.014139</td>
<td>-0.026271</td>
<td>-0.006233</td>
<td>-0.025678</td>
<td>-0.020739</td>
<td>-0.014720</td>
<td>0.001361</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>3.458740</td>
<td>3.840407</td>
<td>3.741995</td>
<td>0.386440</td>
<td>0.660544</td>
<td>3.652768</td>
<td>2.584582</td>
<td>-0.470427</td>
<td>-0.032383</td>
<td>0.341758</td>
<td>0.498124</td>
<td>0.925554</td>
<td>0.219578</td>
<td>0.904644</td>
<td>0.730637</td>
<td>0.518609</td>
<td>-0.047960</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get information for 'Tufts University' and drop the non continuous variables</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tufts_university <span class="op">=</span> full_df.loc[full_df[<span class="st">'College Name'</span>] <span class="op">==</span> <span class="st">'Tufts University'</span>, :]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>tufts_university <span class="op">=</span> tufts_university.drop(columns<span class="op">=</span>[<span class="st">'College Name'</span>, <span class="st">'State'</span>, <span class="st">'Public (1)/ Private (2)'</span>])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the same normalization as for reduced_df</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>tufts_norm <span class="op">=</span> (tufts_university <span class="op">-</span> reduced_df.mean())<span class="op">/</span>reduced_df.std()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with the centroids information from the clustering</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> tufts_norm.append(centroids)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"># appli. rec'd</th>
<th data-quarto-table-cell-role="th"># appl. accepted</th>
<th data-quarto-table-cell-role="th"># new stud. enrolled</th>
<th data-quarto-table-cell-role="th">% new stud. from top 10%</th>
<th data-quarto-table-cell-role="th">% new stud. from top 25%</th>
<th data-quarto-table-cell-role="th"># FT undergrad</th>
<th data-quarto-table-cell-role="th"># PT undergrad</th>
<th data-quarto-table-cell-role="th">in-state tuition</th>
<th data-quarto-table-cell-role="th">out-of-state tuition</th>
<th data-quarto-table-cell-role="th">room</th>
<th data-quarto-table-cell-role="th">board</th>
<th data-quarto-table-cell-role="th">add. fees</th>
<th data-quarto-table-cell-role="th">estim. book costs</th>
<th data-quarto-table-cell-role="th">estim. personal $</th>
<th data-quarto-table-cell-role="th">% fac. w/PHD</th>
<th data-quarto-table-cell-role="th">stud./fac. ratio</th>
<th data-quarto-table-cell-role="th">Graduation rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">475</td>
<td>1.096623</td>
<td>0.615893</td>
<td>0.463390</td>
<td>1.730988</td>
<td>1.690004</td>
<td>0.221677</td>
<td>NaN</td>
<td>1.866005</td>
<td>2.116543</td>
<td>1.145408</td>
<td>1.425498</td>
<td>0.348397</td>
<td>0.313855</td>
<td>-0.563089</td>
<td>1.547610</td>
<td>-0.939412</td>
<td>1.456852</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.098174</td>
<td>-0.109007</td>
<td>-0.106214</td>
<td>-0.010969</td>
<td>-0.018749</td>
<td>-0.103681</td>
<td>-0.073362</td>
<td>0.013353</td>
<td>0.000919</td>
<td>-0.009701</td>
<td>-0.014139</td>
<td>-0.026271</td>
<td>-0.006233</td>
<td>-0.025678</td>
<td>-0.020739</td>
<td>-0.014720</td>
<td>0.001361</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.458740</td>
<td>3.840407</td>
<td>3.741995</td>
<td>0.386440</td>
<td>0.660544</td>
<td>3.652768</td>
<td>2.584582</td>
<td>-0.470427</td>
<td>-0.032383</td>
<td>0.341758</td>
<td>0.498124</td>
<td>0.925554</td>
<td>0.219578</td>
<td>0.904644</td>
<td>0.730637</td>
<td>0.518609</td>
<td>-0.047960</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix dropping the columns containing NaN</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> pairwise.pairwise_distances(combined.dropna(axis<span class="op">=</span><span class="dv">1</span>), metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(d, columns<span class="op">=</span>combined.index, index<span class="op">=</span>combined.index).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">475</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">475</td>
<td>0.000000</td>
<td>5.061369</td>
<td>7.778365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.061369</td>
<td>0.000000</td>
<td>7.815593</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.778365</td>
<td>7.815593</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The distance to cluster 1 is 5.06 (normalized), and to cluster 2 it is 7.8. Tufts is closer to cluster 1. We can therefore imput the missing value for <code># PT undergrad</code> in <code>tufts_norm</code>.</p>
<div id="cell-25" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tufts_norm[<span class="st">'# PT undergrad'</span>] <span class="op">=</span> centroids.loc[<span class="dv">1</span>, <span class="st">'# PT undergrad'</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tufts_norm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"># appli. rec'd</th>
<th data-quarto-table-cell-role="th"># appl. accepted</th>
<th data-quarto-table-cell-role="th"># new stud. enrolled</th>
<th data-quarto-table-cell-role="th">% new stud. from top 10%</th>
<th data-quarto-table-cell-role="th">% new stud. from top 25%</th>
<th data-quarto-table-cell-role="th"># FT undergrad</th>
<th data-quarto-table-cell-role="th"># PT undergrad</th>
<th data-quarto-table-cell-role="th">in-state tuition</th>
<th data-quarto-table-cell-role="th">out-of-state tuition</th>
<th data-quarto-table-cell-role="th">room</th>
<th data-quarto-table-cell-role="th">board</th>
<th data-quarto-table-cell-role="th">add. fees</th>
<th data-quarto-table-cell-role="th">estim. book costs</th>
<th data-quarto-table-cell-role="th">estim. personal $</th>
<th data-quarto-table-cell-role="th">% fac. w/PHD</th>
<th data-quarto-table-cell-role="th">stud./fac. ratio</th>
<th data-quarto-table-cell-role="th">Graduation rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">475</td>
<td>1.096623</td>
<td>0.615893</td>
<td>0.46339</td>
<td>1.730988</td>
<td>1.690004</td>
<td>0.221677</td>
<td>-0.073362</td>
<td>1.866005</td>
<td>2.116543</td>
<td>1.145408</td>
<td>1.425498</td>
<td>0.348397</td>
<td>0.313855</td>
<td>-0.563089</td>
<td>1.54761</td>
<td>-0.939412</td>
<td>1.456852</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="problem-15.2-pharmaceutical-industry" class="level1">
<h1>Problem 15.2: Pharmaceutical Industry</h1>
<p>An equities analyst is studying the pharmaceutical industry and would like your help in exploring and understanding the financial data collected by her firm. Her main objective is to understand the structure of the pharmaceutical industry using some basic financial measures.</p>
<p>Financial data gathered on 21 firms in the pharmaceutical industry are available in the file <em>Pharmaceuticals.csv</em>. For each firm, the following variables are recorded:</p>
<ol type="1">
<li>Market capitalization (in billions of dollars)</li>
<li>Beta</li>
<li>Price/earnings ratio</li>
<li>Return on equity</li>
<li>Return on assets</li>
<li>Asset turnover</li>
<li>Leverage</li>
<li>Estimated revenue growth</li>
<li>Net profit margin</li>
<li>Median recommendation (across major brokerages)</li>
<li>Location of firm’s headquarters</li>
<li>Stock exchange on which the firm is listed</li>
</ol>
<p>Use cluster analysis to explore and analyze the given dataset as follows:</p>
<section id="solution-15.2.a" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.2.a">Solution 15.2.a</h2>
<p>Use only the numerical variables (1-9) to cluster the 21 firms. Justify the various choices made in conducting the cluster analysis, such as weights for different variables, the specific clustering algorithm(s) used, the number of clusters formed, and so on.</p>
<div id="cell-27" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data, use the column Company as row names</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pharma_df <span class="op">=</span> pd.read_csv(DATA <span class="op">/</span> <span class="st">'Pharmaceuticals.csv'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>pharma_df.set_index(<span class="st">'Symbol'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>pharma_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Market_Cap</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">PE_Ratio</th>
<th data-quarto-table-cell-role="th">ROE</th>
<th data-quarto-table-cell-role="th">ROA</th>
<th data-quarto-table-cell-role="th">Asset_Turnover</th>
<th data-quarto-table-cell-role="th">Leverage</th>
<th data-quarto-table-cell-role="th">Rev_Growth</th>
<th data-quarto-table-cell-role="th">Net_Profit_Margin</th>
<th data-quarto-table-cell-role="th">Median_Recommendation</th>
<th data-quarto-table-cell-role="th">Location</th>
<th data-quarto-table-cell-role="th">Exchange</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Symbol</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ABT</td>
<td>Abbott Laboratories</td>
<td>68.44</td>
<td>0.32</td>
<td>24.7</td>
<td>26.4</td>
<td>11.8</td>
<td>0.7</td>
<td>0.42</td>
<td>7.54</td>
<td>16.1</td>
<td>Moderate Buy</td>
<td>US</td>
<td>NYSE</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AGN</td>
<td>Allergan, Inc.</td>
<td>7.58</td>
<td>0.41</td>
<td>82.5</td>
<td>12.9</td>
<td>5.5</td>
<td>0.9</td>
<td>0.60</td>
<td>9.16</td>
<td>5.5</td>
<td>Moderate Buy</td>
<td>CANADA</td>
<td>NYSE</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AHM</td>
<td>Amersham plc</td>
<td>6.30</td>
<td>0.46</td>
<td>20.7</td>
<td>14.9</td>
<td>7.8</td>
<td>0.9</td>
<td>0.27</td>
<td>7.05</td>
<td>11.2</td>
<td>Strong Buy</td>
<td>UK</td>
<td>NYSE</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AZN</td>
<td>AstraZeneca PLC</td>
<td>67.63</td>
<td>0.52</td>
<td>21.5</td>
<td>27.4</td>
<td>15.4</td>
<td>0.9</td>
<td>0.00</td>
<td>15.00</td>
<td>18.0</td>
<td>Moderate Sell</td>
<td>UK</td>
<td>NYSE</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVE</td>
<td>Aventis</td>
<td>47.16</td>
<td>0.32</td>
<td>20.1</td>
<td>21.8</td>
<td>7.5</td>
<td>0.6</td>
<td>0.34</td>
<td>26.81</td>
<td>12.9</td>
<td>Moderate Buy</td>
<td>FRANCE</td>
<td>NYSE</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pharma_data <span class="op">=</span> pharma_df.drop(columns<span class="op">=</span>[<span class="st">'Name'</span>, <span class="st">'Median_Recommendation'</span>, <span class="st">'Location'</span>, <span class="st">'Exchange'</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pharma_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Market_Cap</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">PE_Ratio</th>
<th data-quarto-table-cell-role="th">ROE</th>
<th data-quarto-table-cell-role="th">ROA</th>
<th data-quarto-table-cell-role="th">Asset_Turnover</th>
<th data-quarto-table-cell-role="th">Leverage</th>
<th data-quarto-table-cell-role="th">Rev_Growth</th>
<th data-quarto-table-cell-role="th">Net_Profit_Margin</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Symbol</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ABT</td>
<td>68.44</td>
<td>0.32</td>
<td>24.7</td>
<td>26.4</td>
<td>11.8</td>
<td>0.7</td>
<td>0.42</td>
<td>7.54</td>
<td>16.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AGN</td>
<td>7.58</td>
<td>0.41</td>
<td>82.5</td>
<td>12.9</td>
<td>5.5</td>
<td>0.9</td>
<td>0.60</td>
<td>9.16</td>
<td>5.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AHM</td>
<td>6.30</td>
<td>0.46</td>
<td>20.7</td>
<td>14.9</td>
<td>7.8</td>
<td>0.9</td>
<td>0.27</td>
<td>7.05</td>
<td>11.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AZN</td>
<td>67.63</td>
<td>0.52</td>
<td>21.5</td>
<td>27.4</td>
<td>15.4</td>
<td>0.9</td>
<td>0.00</td>
<td>15.00</td>
<td>18.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVE</td>
<td>47.16</td>
<td>0.32</td>
<td>20.1</td>
<td>21.8</td>
<td>7.5</td>
<td>0.6</td>
<td>0.34</td>
<td>26.81</td>
<td>12.9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Normalize: normalization gives the same importance to all the variables and so is important for distance calculations.</p>
<div id="cell-30" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pharma_norm <span class="op">=</span> pharma_data.<span class="bu">apply</span>(preprocessing.scale, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>), squeeze<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, method <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'single'</span>, <span class="st">'complete'</span>, <span class="st">'average'</span>, <span class="st">'weighted'</span>, <span class="st">'centroid'</span>, <span class="st">'median'</span>, <span class="st">'ward'</span>]):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> linkage(pharma_norm, method<span class="op">=</span>method)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    dendrogram(Z, color_threshold<span class="op">=</span><span class="dv">0</span>, ax<span class="op">=</span>ax, no_labels<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(method)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>fig.delaxes(axes[<span class="dv">2</span>,<span class="dv">1</span>])  <span class="co"># remove empty subplots</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>fig.delaxes(axes[<span class="dv">2</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Ward clustering nicely separates the dataset into four clusters.</p>
<div id="cell-33" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> linkage(pharma_norm, method<span class="op">=</span><span class="st">'ward'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>memb <span class="op">=</span> fcluster(Z, <span class="dv">4</span>, criterion<span class="op">=</span><span class="st">'maxclust'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell" data-scrolled="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k-means clustering</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>inertia <span class="op">=</span> []</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n_clusters <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">7</span>):</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>n_clusters, random_state<span class="op">=</span><span class="dv">1</span>).fit(pharma_norm)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    inertia.append(kmeans.inertia_ <span class="op">/</span> n_clusters)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>inertias <span class="op">=</span> pd.DataFrame({<span class="st">'n_clusters'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">7</span>), <span class="st">'inertia'</span>: inertia})</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> inertias.plot(x<span class="op">=</span><span class="st">'n_clusters'</span>, y<span class="op">=</span><span class="st">'inertia'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of clusters(k)'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Within-Cluster Squared Distances'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>, <span class="fl">1.1</span> <span class="op">*</span> inertias.inertia.<span class="bu">max</span>()))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ax.legend().set_visible(<span class="va">False</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Three to four clusters seem to be a good choice</p>
<div id="cell-36" class="cell" data-scrolled="false" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">0</span>).fit(pharma_norm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two factors can help us decide how many clusters to form:</p>
<ol type="1">
<li><p>The purpose of the inquiry. How many clusters are we going to want to deal with? In this case, to understand the structure of the industry in financial terms we might use basic domain knowledge to consider that size and financial performance are fundamental dimensions into which our various metrics fall. To make sense of our analysis, we will need at least two clusters, but more than 3 or 4 will probably defeat the purpose of clustering, which is to simplify matters (at least for the purposes of initial analysis).</p></li>
<li><p>How do the clusters look when trying 2, 3, 4, 5 clusters? Are they nicely separated? Do they have enough members to be useful? Do they look like natural clusters (as opposed to arbitrary decisions about cluster membership)? Normalizing the data is important to ensure that the “distance measured” accords equal weight to each variable. Without normalization, the variable with the largest scale will dominate the measure.</p></li>
</ol>
<p>Trying both k-means and hierarchical clustering, k-means of 3 and 4, and hierarchical clustering with Wards method give useful results. We will focus mainly on Wards clustering with k=4, but similar analysis could be made for the other choices.</p>
</section>
<section id="solution-15.2.b" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.2.b">Solution 15.2.b</h2>
<p>Interpret the clusters with respect to the categorical variables used in forming the clusters.</p>
<div id="cell-39" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> {}</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> pharma_data.groupby(memb):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    centroids[<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key)] <span class="op">=</span> item.mean()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(centroids).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster 1</th>
<th data-quarto-table-cell-role="th">Cluster 2</th>
<th data-quarto-table-cell-role="th">Cluster 3</th>
<th data-quarto-table-cell-role="th">Cluster 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Market_Cap</td>
<td>157.02</td>
<td>62.88</td>
<td>26.91</td>
<td>8.82</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Beta</td>
<td>0.48</td>
<td>0.41</td>
<td>0.64</td>
<td>0.62</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PE_Ratio</td>
<td>22.22</td>
<td>20.23</td>
<td>55.63</td>
<td>19.61</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ROE</td>
<td>44.42</td>
<td>30.71</td>
<td>10.10</td>
<td>16.96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ROA</td>
<td>17.70</td>
<td>13.39</td>
<td>4.20</td>
<td>6.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Asset_Turnover</td>
<td>0.95</td>
<td>0.71</td>
<td>0.70</td>
<td>0.54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Leverage</td>
<td>0.22</td>
<td>0.39</td>
<td>0.32</td>
<td>1.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rev_Growth</td>
<td>18.53</td>
<td>5.38</td>
<td>7.00</td>
<td>21.14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Net_Profit_Margin</td>
<td>19.58</td>
<td>20.51</td>
<td>5.13</td>
<td>13.19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Cluster 1 companies are big, fast growing, profitable and not leveraged.</li>
<li>Cluster 2 companies are of moderate size (market cap), profitable and slow growing, not leveraged.</li>
<li>Cluster 3 companies are small, slow growing and of low profitability.</li>
<li>Cluster 4 companies are small, fast growing, profitable and highly leveraged</li>
</ul>
</section>
<section id="solution-15.2.c" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.2.c">Solution 15.2.c</h2>
<p>Is there a pattern in the clusters with respect to the numerical variables (10-12)? (those not used in forming the clusters).</p>
<div id="cell-42" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(pd.Series(item.Median_Recommendation.value_counts(), name<span class="op">=</span><span class="ss">f'Cluster </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> key, item <span class="kw">in</span> pharma_df.groupby(memb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Hold</th>
<th data-quarto-table-cell-role="th">Moderate Buy</th>
<th data-quarto-table-cell-role="th">Moderate Sell</th>
<th data-quarto-table-cell-role="th">Strong Buy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 1</td>
<td>2.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 2</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 3</td>
<td>2.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 4</td>
<td>1.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With respect to buy/hold recommendations, clusters 2 and 4 are the interesting ones, characterized by mixed recommendations for each. Cluster 4, for example, has recommendations ranging from “moderate sell” to “strong buy”.</p>
<div id="cell-44" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(pd.Series(item.Location.value_counts(), name<span class="op">=</span><span class="ss">f'Cluster </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> key, item <span class="kw">in</span> pharma_df.groupby(memb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">US</th>
<th data-quarto-table-cell-role="th">UK</th>
<th data-quarto-table-cell-role="th">SWITZERLAND</th>
<th data-quarto-table-cell-role="th">GERMANY</th>
<th data-quarto-table-cell-role="th">CANADA</th>
<th data-quarto-table-cell-role="th">IRELAND</th>
<th data-quarto-table-cell-role="th">FRANCE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 1</td>
<td>3.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 2</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 3</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 4</td>
<td>4.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With respect to country, the various countries are fairly well spread out across the 4 clusters, though cluster 2 has 5 US firms.</p>
<div id="cell-46" class="cell" data-scrolled="true" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(pd.Series(item.Exchange.value_counts(), name<span class="op">=</span><span class="ss">f'Cluster </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> key, item <span class="kw">in</span> pharma_df.groupby(memb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NYSE</th>
<th data-quarto-table-cell-role="th">NASDAQ</th>
<th data-quarto-table-cell-role="th">AMEX</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 1</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 2</td>
<td>7.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cluster 3</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cluster 4</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With respect to exchange, there are only two non-NYSE firms in the data set, and they are in cluster 4, one of the “small firms” cluster. (This is consistent with the nature of the AMEX and NASDAQ, which typically host smaller firms than the NYSE.)</p>
</section>
<section id="solution-15.2.d" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.2.d">Solution 15.2.d</h2>
<p>Provide an appropriate name for each cluster using any or all of the variables in the dataset.</p>
<p>See PA3 week 2 discussion task</p>
<ul>
<li>Cluster 1: The big boys, financial stars</li>
<li>Cluster 2: International establishment with decent financial performance.</li>
<li>Cluster 3: Slow growth mid-size</li>
<li>Cluster 4: Fast growth small-cap</li>
</ul>
</section>
</section>
<section id="problem-15.3-customer-rating-of-breakfast-cereals" class="level1">
<h1>Problem 15.3: Customer Rating of Breakfast Cereals</h1>
<p>The dataset <em>Cereals.csv</em> includes nutritional information, store display, and consumer ratings for 77 breakfast cereals.</p>
<p><strong>Data preprocessing:</strong> Remove all cereals with missing values.</p>
<div id="cell-51" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cereals_df <span class="op">=</span> pd.read_csv(DATA <span class="op">/</span> <span class="st">'Cereals.csv'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># drop rows with missing data</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Before: '</span>, cereals_df.shape)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>cereals_nonmissing <span class="op">=</span> cereals_df.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'After: '</span>, cereals_nonmissing.shape)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>cereals_nonmissing.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Before:  (77, 16)
After:  (74, 16)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">mfr</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">calories</th>
<th data-quarto-table-cell-role="th">protein</th>
<th data-quarto-table-cell-role="th">fat</th>
<th data-quarto-table-cell-role="th">sodium</th>
<th data-quarto-table-cell-role="th">fiber</th>
<th data-quarto-table-cell-role="th">carbo</th>
<th data-quarto-table-cell-role="th">sugars</th>
<th data-quarto-table-cell-role="th">potass</th>
<th data-quarto-table-cell-role="th">vitamins</th>
<th data-quarto-table-cell-role="th">shelf</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">cups</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100%_Bran</td>
<td>N</td>
<td>C</td>
<td>70</td>
<td>4</td>
<td>1</td>
<td>130</td>
<td>10.0</td>
<td>5.0</td>
<td>6.0</td>
<td>280.0</td>
<td>25</td>
<td>3</td>
<td>1.0</td>
<td>0.33</td>
<td>68.402973</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100%_Natural_Bran</td>
<td>Q</td>
<td>C</td>
<td>120</td>
<td>3</td>
<td>5</td>
<td>15</td>
<td>2.0</td>
<td>8.0</td>
<td>8.0</td>
<td>135.0</td>
<td>0</td>
<td>3</td>
<td>1.0</td>
<td>1.00</td>
<td>33.983679</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>All-Bran</td>
<td>K</td>
<td>C</td>
<td>70</td>
<td>4</td>
<td>1</td>
<td>260</td>
<td>9.0</td>
<td>7.0</td>
<td>5.0</td>
<td>320.0</td>
<td>25</td>
<td>3</td>
<td>1.0</td>
<td>0.33</td>
<td>59.425505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>All-Bran_with_Extra_Fiber</td>
<td>K</td>
<td>C</td>
<td>50</td>
<td>4</td>
<td>0</td>
<td>140</td>
<td>14.0</td>
<td>8.0</td>
<td>0.0</td>
<td>330.0</td>
<td>25</td>
<td>3</td>
<td>1.0</td>
<td>0.50</td>
<td>93.704912</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Apple_Cinnamon_Cheerios</td>
<td>G</td>
<td>C</td>
<td>110</td>
<td>2</td>
<td>2</td>
<td>180</td>
<td>1.5</td>
<td>10.5</td>
<td>10.0</td>
<td>70.0</td>
<td>25</td>
<td>1</td>
<td>1.0</td>
<td>0.75</td>
<td>29.509541</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="solution-15.3.a" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.3.a">Solution 15.3.a</h2>
<p>Apply hierarchical clustering to the data using Euclidean distance to the normalized measurements. Compare the dendrograms from single linkage and complete linkage, and look at cluster centroids. Comment on the structure of the clusters and on their stability. (<em>Hint</em>: To obtain cluster centroids for hierarchical clustering, compute the average values of each cluster members, using <em>groupby()</em> with the cluster centers followed by <em>mean</em>: <em>dataframe.groupby(clusterlabel).mean()</em>.)</p>
<div id="cell-53" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize data</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> cereals_nonmissing.drop(columns<span class="op">=</span>[<span class="st">'name'</span>, <span class="st">'mfr'</span>, <span class="st">'type'</span>])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>cereals_norm <span class="op">=</span> (temp <span class="op">-</span> temp.mean())<span class="op">/</span>temp.std()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>), squeeze<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (method, threshold) <span class="kw">in</span> <span class="bu">enumerate</span>([(<span class="st">'single'</span>, <span class="fl">3.5</span>), (<span class="st">'complete'</span>, <span class="dv">7</span>)]):</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[<span class="dv">0</span>, i]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> linkage(cereals_norm, method<span class="op">=</span>method, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    dendrogram(Z, color_threshold<span class="op">=</span>threshold, ax<span class="op">=</span>ax, no_labels<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(method <span class="op">+</span> <span class="st">' linkage'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># redo clustering after removing data points from start and end of dataset</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>), squeeze<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (method, threshold) <span class="kw">in</span> <span class="bu">enumerate</span>([(<span class="st">'single'</span>, <span class="fl">3.5</span>), (<span class="st">'complete'</span>, <span class="dv">7</span>)]):</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[<span class="dv">0</span>, i]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> linkage(cereals_norm.iloc[<span class="dv">4</span>:<span class="op">-</span><span class="dv">4</span>,:], method<span class="op">=</span>method, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    dendrogram(Z, color_threshold<span class="op">=</span>threshold, ax<span class="op">=</span>ax, no_labels<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(method <span class="op">+</span> <span class="st">' linkage'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Clusters appear to be not well stabilized as removing some data resulted in different dendrograms.</p>
</section>
<section id="solution-15.3.b" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.3.b">Solution 15.3.b</h2>
<p>Which method leads to the most insightful or meaningful clusters?</p>
<p>Complete linkage leads to more insightful clusters.</p>
</section>
<section id="solution-15.3.c" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.3.c">Solution 15.3.c</h2>
<p>Choose one of the methods. How many clusters would you use? What distance is used for this cutoff? (Look at the dendrogram.)</p>
<p>We would use complete linkage method, cutting the dendrogram at around 7 to get 5 clusters.</p>
</section>
<section id="solution-15.3.d" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.3.d">Solution 15.3.d</h2>
<p>The elementary public schools would like to choose a set of cereals to include in their daily cafeterias. Every day a different cereal is offered, but all cereals should support a healthy diet. For this goal, you are requested to find a cluster of “healthy cereals.” Should the data be normalized? If not, how should they be used in the cluster analysis?</p>
<div id="cell-59" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> linkage(cereals_norm, method<span class="op">=</span><span class="st">'ward'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>memb <span class="op">=</span> fcluster(Z, <span class="dv">5</span>, criterion<span class="op">=</span><span class="st">'maxclust'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> {}</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> cereals_nonmissing.groupby(memb):</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    centroids[<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key)] <span class="op">=</span> item.mean()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(centroids).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster 1</th>
<th data-quarto-table-cell-role="th">Cluster 2</th>
<th data-quarto-table-cell-role="th">Cluster 3</th>
<th data-quarto-table-cell-role="th">Cluster 4</th>
<th data-quarto-table-cell-role="th">Cluster 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">calories</td>
<td>63.33</td>
<td>124.00</td>
<td>110.95</td>
<td>82.22</td>
<td>103.81</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">protein</td>
<td>4.00</td>
<td>3.15</td>
<td>1.52</td>
<td>2.44</td>
<td>2.71</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat</td>
<td>0.67</td>
<td>1.95</td>
<td>1.00</td>
<td>0.11</td>
<td>0.52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sodium</td>
<td>176.67</td>
<td>155.00</td>
<td>172.38</td>
<td>1.67</td>
<td>226.19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fiber</td>
<td>11.00</td>
<td>3.10</td>
<td>0.57</td>
<td>2.11</td>
<td>1.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">carbo</td>
<td>6.67</td>
<td>13.95</td>
<td>12.62</td>
<td>15.33</td>
<td>18.48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sugars</td>
<td>3.67</td>
<td>9.35</td>
<td>11.29</td>
<td>2.33</td>
<td>3.33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">potass</td>
<td>310.00</td>
<td>151.50</td>
<td>45.95</td>
<td>90.56</td>
<td>73.81</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">vitamins</td>
<td>25.00</td>
<td>31.25</td>
<td>25.00</td>
<td>11.11</td>
<td>39.29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">shelf</td>
<td>3.00</td>
<td>2.90</td>
<td>1.67</td>
<td>2.00</td>
<td>2.10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">weight</td>
<td>1.00</td>
<td>1.17</td>
<td>1.00</td>
<td>0.87</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cups</td>
<td>0.39</td>
<td>0.69</td>
<td>0.89</td>
<td>0.85</td>
<td>0.93</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">rating</td>
<td>73.84</td>
<td>38.26</td>
<td>28.85</td>
<td>63.02</td>
<td>46.47</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The most deleterious attributes of breakfast cereals, particularly those for children, are high levels of salt and sugar. Cluster 4 is the most health cluster in this respect.</p>
</section>
</section>
<section id="problem-15.4-marketing-to-frequent-fliers" class="level1">
<h1>Problem 15.4: Marketing to Frequent Fliers</h1>
<p>The file <em>EastWestAirlinesCluster.csv</em> contains information on 3999 passengers who belong to an airline’s frequent flier program. For each passenger, the data include information on their mileage history and on different ways they accrued or spent miles in the last year. The goal is to try to identify clusters of passengers that have similar characteristics for the purpose of targeting different segments for different types of mileage offers.</p>
<section id="solution-15.4.a" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.a">Solution 15.4.a</h2>
<p>Apply hierarchical clustering with Euclidean distance and Ward’s method. Make sure to normalize the data first. How many clusters appear?</p>
<div id="cell-62" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>airlines_df <span class="op">=</span> pd.read_csv(DATA <span class="op">/</span> <span class="st">'EastWestAirlinesCluster.csv'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>airlines_df <span class="op">=</span> airlines_df.set_index(<span class="st">"ID#"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>airlines_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">Qual_miles</th>
<th data-quarto-table-cell-role="th">cc1_miles</th>
<th data-quarto-table-cell-role="th">cc2_miles</th>
<th data-quarto-table-cell-role="th">cc3_miles</th>
<th data-quarto-table-cell-role="th">Bonus_miles</th>
<th data-quarto-table-cell-role="th">Bonus_trans</th>
<th data-quarto-table-cell-role="th">Flight_miles_12mo</th>
<th data-quarto-table-cell-role="th">Flight_trans_12</th>
<th data-quarto-table-cell-role="th">Days_since_enroll</th>
<th data-quarto-table-cell-role="th">Award?</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ID#</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>28143</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>174</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>7000</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>19244</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>215</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>6968</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>41354</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4123</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>7034</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>14776</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>500</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>6952</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>97752</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>1</td>
<td>43300</td>
<td>26</td>
<td>2077</td>
<td>4</td>
<td>6935</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>airlines_norm <span class="op">=</span> (airlines_df <span class="op">-</span> airlines_df.mean())<span class="op">/</span>airlines_df.std()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>airlines_norm.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">Qual_miles</th>
<th data-quarto-table-cell-role="th">cc1_miles</th>
<th data-quarto-table-cell-role="th">cc2_miles</th>
<th data-quarto-table-cell-role="th">cc3_miles</th>
<th data-quarto-table-cell-role="th">Bonus_miles</th>
<th data-quarto-table-cell-role="th">Bonus_trans</th>
<th data-quarto-table-cell-role="th">Flight_miles_12mo</th>
<th data-quarto-table-cell-role="th">Flight_trans_12</th>
<th data-quarto-table-cell-role="th">Days_since_enroll</th>
<th data-quarto-table-cell-role="th">Award?</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ID#</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.451084</td>
<td>-0.186275</td>
<td>-0.769482</td>
<td>-0.09823</td>
<td>-0.062759</td>
<td>-0.702698</td>
<td>-1.103926</td>
<td>-0.328562</td>
<td>-0.362123</td>
<td>1.395280</td>
<td>-0.766823</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>-0.539389</td>
<td>-0.186275</td>
<td>-0.769482</td>
<td>-0.09823</td>
<td>-0.062759</td>
<td>-0.701001</td>
<td>-0.999801</td>
<td>-0.328562</td>
<td>-0.362123</td>
<td>1.379784</td>
<td>-0.766823</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.319991</td>
<td>-0.186275</td>
<td>-0.769482</td>
<td>-0.09823</td>
<td>-0.062759</td>
<td>-0.539185</td>
<td>-0.791550</td>
<td>-0.328562</td>
<td>-0.362123</td>
<td>1.411744</td>
<td>-0.766823</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.583726</td>
<td>-0.186275</td>
<td>-0.769482</td>
<td>-0.09823</td>
<td>-0.062759</td>
<td>-0.689200</td>
<td>-1.103926</td>
<td>-0.328562</td>
<td>-0.362123</td>
<td>1.372037</td>
<td>-0.766823</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.239648</td>
<td>-0.186275</td>
<td>1.409295</td>
<td>-0.09823</td>
<td>-0.062759</td>
<td>1.082986</td>
<td>1.499207</td>
<td>1.154788</td>
<td>0.692404</td>
<td>1.363805</td>
<td>1.303755</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> linkage(airlines_norm, method<span class="op">=</span><span class="st">'ward'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>dendrogram(Z, color_threshold<span class="op">=</span><span class="dv">100</span>, no_labels<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The dataset can be split into two clusters.</p>
</section>
<section id="solution-15.4.b" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.b">Solution 15.4.b</h2>
<p>What would happen if the data were not normalized?</p>
<p>Normalizing the data is important to ensure that the “distance measured” accords equal weight to each variable - without normalization, the variable with the largest scale will dominate the measure. Here the variables that have the largest scale are Balance, Bonus_trans, Fligt_miles_12mo, and Days_since_enroll. These variables will dominate the measure if we don’t standardize the data.</p>
</section>
<section id="solution-15.4.c" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.c">Solution 15.4.c</h2>
<p>Compare the cluster centroid to characterize the different clusters, and try to give each cluster a label.</p>
<div id="cell-67" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>memb <span class="op">=</span> fcluster(linkage(airlines_norm, method<span class="op">=</span><span class="st">'ward'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>), <span class="dv">2</span>, criterion<span class="op">=</span><span class="st">'maxclust'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> {}</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> airlines_df.groupby(memb):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    centroids[key] <span class="op">=</span> item.mean()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">: size </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key, <span class="bu">len</span>(item)))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(centroids).transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster 1: size 2489
Cluster 2: size 1510</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">Qual_miles</th>
<th data-quarto-table-cell-role="th">cc1_miles</th>
<th data-quarto-table-cell-role="th">cc2_miles</th>
<th data-quarto-table-cell-role="th">cc3_miles</th>
<th data-quarto-table-cell-role="th">Bonus_miles</th>
<th data-quarto-table-cell-role="th">Bonus_trans</th>
<th data-quarto-table-cell-role="th">Flight_miles_12mo</th>
<th data-quarto-table-cell-role="th">Flight_trans_12</th>
<th data-quarto-table-cell-role="th">Days_since_enroll</th>
<th data-quarto-table-cell-role="th">Award?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>46718.863399</td>
<td>9.274407</td>
<td>1.242266</td>
<td>1.023303</td>
<td>1.00000</td>
<td>5037.792688</td>
<td>7.091201</td>
<td>221.167135</td>
<td>0.700281</td>
<td>3772.785858</td>
<td>0.188027</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>117912.886093</td>
<td>366.377483</td>
<td>3.406623</td>
<td>1.000000</td>
<td>1.03245</td>
<td>37101.439735</td>
<td>19.037086</td>
<td>853.826490</td>
<td>2.483444</td>
<td>4688.513245</td>
<td>0.670861</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observing the cluster centroids we can see that Cluster 1 has lower values on virtually all variables. We can think of Cluster 1 as “occasional and minimal flyers” and Cluster 2 as “frequent and loyal travelers.”</p>
</section>
<section id="solution-15.4.d" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.d">Solution 15.4.d</h2>
<p>To check the stability of the clusters, remove a random 5% of the data (by taking a random sample of 95% of the records), and repeat the analysis. Does the same picture emerge?</p>
<div id="cell-69" class="cell" data-scrolled="false" data-execution_count="33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we repeat the random sampling three times</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> linkage(airlines_norm.sample(frac<span class="op">=</span><span class="fl">0.95</span>), method<span class="op">=</span><span class="st">'ward'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    dendrogram(Z, color_threshold<span class="op">=</span><span class="dv">100</span>, ax<span class="op">=</span>ax, no_labels<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The dendrogram looks a bit different, but the same conclusions result: clusters occur naturally at 2 clusters, and the characteristics of the resulting clusters are similar to those in the clusters found in the entire data set.</p>
</section>
<section id="solution-15.4.e" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.e">Solution 15.4.e</h2>
<p>Use <span class="math inline">\(k\)</span>-means clustering with the number of clusters that you found above. Does the same picture emerge?</p>
<div id="cell-72" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">0</span>).fit(airlines_norm)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the cluster membership between k-means and hierarchical clustering</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>pd.crosstab(memb, kmeans.labels_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">col_0</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">row_0</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2436</td>
<td>53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>261</td>
<td>1249</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The cluster membership from the two methods is comparable.</p>
<div id="cell-74" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> {}</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, item <span class="kw">in</span> airlines_df.groupby(kmeans.labels_):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    centroids[key] <span class="op">=</span> item.mean()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">: size </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(key, <span class="bu">len</span>(item)))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(centroids).transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster 0: size 2697
Cluster 1: size 1302</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">Qual_miles</th>
<th data-quarto-table-cell-role="th">cc1_miles</th>
<th data-quarto-table-cell-role="th">cc2_miles</th>
<th data-quarto-table-cell-role="th">cc3_miles</th>
<th data-quarto-table-cell-role="th">Bonus_miles</th>
<th data-quarto-table-cell-role="th">Bonus_trans</th>
<th data-quarto-table-cell-role="th">Flight_miles_12mo</th>
<th data-quarto-table-cell-role="th">Flight_trans_12</th>
<th data-quarto-table-cell-role="th">Days_since_enroll</th>
<th data-quarto-table-cell-role="th">Award?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>45041.650352</td>
<td>89.232481</td>
<td>1.310716</td>
<td>1.016685</td>
<td>1.000371</td>
<td>5421.404894</td>
<td>7.363737</td>
<td>215.211346</td>
<td>0.635521</td>
<td>3720.834631</td>
<td>0.206897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>132760.658986</td>
<td>257.798771</td>
<td>3.610599</td>
<td>1.009985</td>
<td>1.036866</td>
<td>41429.117512</td>
<td>20.380952</td>
<td>967.233487</td>
<td>2.902458</td>
<td>4942.417819</td>
<td>0.708909</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-75" class="cell" data-scrolled="false" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> pd.DataFrame(kmeans.cluster_centers_, columns<span class="op">=</span>airlines_norm.columns)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>centroids[<span class="st">'cluster'</span>] <span class="op">=</span> [<span class="st">'Cluster </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(i) <span class="cf">for</span> i <span class="kw">in</span> centroids.index]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(right<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> parallel_coordinates(centroids, class_column<span class="op">=</span><span class="st">'cluster'</span>, colormap<span class="op">=</span><span class="st">'Dark2'</span>, linewidth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.95</span>, <span class="fl">0.5</span>))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">7.5</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch-15-ProbSolutions-CA_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-15.4.f" class="level2">
<h2 class="anchored" data-anchor-id="solution-15.4.f">Solution 15.4.f</h2>
<p>Which clusters would you target for offers, and what types of offers would you target to customers in that cluster?</p>
<p>For the “minimal, non-frequent” flyers, two types of offers might be used. 1. Offers to liquidate the mileage, to remove it as a liability (e.g., offers to purchase magazine subscriptions) 2. Offers for special mileage bonuses if a number of segments or miles is flown in a limited period of time, in case some of these flyers are regular customers of other airlines, or new flyers, in hopes that some of them will become more “invested” in East-West.</p>
<p>For the frequent, loyal flyer we might</p>
<ol type="1">
<li>Offer luxury goods in conjunction with partners (high end vacations, exclusive real estate, etc.) – frequent flyers are likely to be relatively prosperous (compared to non-frequent flyers).</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>